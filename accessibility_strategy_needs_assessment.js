const pages = [
    {
        "name": "Accessibility Strategy Needs Assessment - Home",
        "type": "home",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024",
        "section-name": "",
        "section-url": ""
    },
    {
        "name": "Home",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024",
        "section-name": "Home",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "Executive Summary",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/executive-summary",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "About Accessible Services",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/about-accessible-services",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "Guiding Visions and Values",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/guiding-visions-and-values",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "Who We Serve",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/who-we-serve",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "Glossary",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/glossary",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "1. Streets Capital Projects",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "1.1 Consistent Accessibility Guidance on Streets Projects",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects/11-consistent-accessibility-guidance-on-streets-projects",
        "section-name": "Streets: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects"
    },
    {
        "name": "1.2 Multi-Agency Project Coordination",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects/12-multi-agency-project-coordination",
        "section-name": "Streets: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects"
    },
    {
        "name": "1.3 Flexible and Responsive Safety Improvements",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects/13-flexible-and-responsive-safety-improvements",
        "section-name": "Streets: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects"
    },
    {
        "name": "1.4 Accessible Pedestrian Signals",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects/14-accessible-pedestrian-signals",
        "section-name": "Streets: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects"
    },
    {
        "name": "1.5 Accessible Parking and Loading",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects/15-accessible-parking-and-loading",
        "section-name": "Streets: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects"
    },
    {
        "name": "1.6 Parking and Charging of Personal Mobility Devices",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects/16-parking-and-charging-of-personal-mobility-devices",
        "section-name": "Streets: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-capital-projects"
    },
    {
        "name": "2. Streets Policy and Planning",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "2.1 Accessibility-Informed Programs and Planning",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning/21-accessibility-informed-programs-and-planning",
        "section-name": "Streets: Policy and Planning",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning"
    },
    {
        "name": "2.2 Accessibility-Informed Data and Evaluations",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning/22-accessibility-informed-data-and-evaluations",
        "section-name": "Streets: Policy and Planning",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning"
    },
    {
        "name": "2.3 Accessible Emerging Private Passenger Services",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning/23-accessible-emerging-private-passenger-services",
        "section-name": "Streets: Policy and Planning",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning"
    },
    {
        "name": "2.4 Increased Adoption of Adaptive Cycling and Scooter Programs",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning/24-increased-adoption-of-adaptive-cycling-and-scooter-programs",
        "section-name": "Streets: Policy and Planning",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/streets-policy-and-planning"
    },
    {
        "name": "3. Muni Capital Projects",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "3.1 Accessible Muni Vehicles",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects/31-accessible-muni-vehicles",
        "section-name": "Muni: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects"
    },
    {
        "name": "3.2 Reliable Elevators and Escalators",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects/32-reliable-elevators-and-escalators",
        "section-name": "Muni: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects"
    },
    {
        "name": "3.3 Accessible Surface Rail Stops",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects/33-accessible-surface-rail-stops",
        "section-name": "Muni: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects"
    },
    {
        "name": "3.4 Accessible Signage and Wayfinding",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects/34-accessible-signage-and-wayfinding",
        "section-name": "Muni: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects"
    },
    {
        "name": "3.5 Improved Bus Shelters",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects/35-improved-bus-stop-amenities",
        "section-name": "Muni: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects"
    },
    {
        "name": "3.6 Modified Flag Stops",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects/36-modified-flag-stops-",
        "section-name": "Muni: Capital Projects",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-capital-projects"
    },
    {
        "name": "4. Muni Service Planning and Policy",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "4.1 Service Planning for Accessibility",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy/41-population-specific-travel-patterns-and-concerns-",
        "section-name": "Muni: Service Planning and Policy",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy"
    },
    {
        "name": "4.2 Affordable Muni",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy/42-affordable-muni",
        "section-name": "Muni: Service Planning and Policy",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy"
    },
    {
        "name": "4.3 Operator Training Refreshers Based Upon Customer Feedback",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy/43-operator-training-refreshers-based-upon-customer-feedback",
        "section-name": "Muni: Service Planning and Policy",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy"
    },
    {
        "name": "4.4 Accessible Communication of Service Schedules and Changes",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy/44-accessible-communication-of-service-changes-and-disruptions",
        "section-name": "Muni: Service Planning and Policy",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy"
    },
    {
        "name": "4.5 Continued Community Collaboration",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy/45-continued-community-collaboration",
        "section-name": "Muni: Service Planning and Policy",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/muni-service-planning-and-policy"
    },
    {
        "name": "5. Paratransit Mobility Management",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "5.1 Effective Travel Training Resources and Materials",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management/51-effective-travel-training-resources-and-materials",
        "section-name": "Paratransit: Mobility Management",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management"
    },
    {
        "name": "5.2 \"No-Wrong-Door\" Approach",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management/52-no-wrong-door-approach",
        "section-name": "Paratransit: Mobility Management",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management"
    },
    {
        "name": "5.3 Support Community Health",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management/53-support-community-health",
        "section-name": "Paratransit: Mobility Management",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management"
    },
    {
        "name": "5.4 Improved Engagement to Non-English Speaking Communities",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management/54-improved-engagement-to-non-english-speaking-communities",
        "section-name": "Paratransit: Mobility Management",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-mobility-management"
    },
    {
        "name": "6. Paratransit Capital",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-capital",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "6.1 Electric Paratransit Vehicle Procurement",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-capital/61-electric-paratransit-vehicle-procurement",
        "section-name": "Paratransit: Capital",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-capital"
    },
    {
        "name": "6.2 Permanent Paratransit Facility",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-capital/62-permanent-paratransit-facility",
        "section-name": "Paratransit: Capital",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-capital"
    },
    {
        "name": "6.3 Other Physical Technological Investments",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-capital/63-other-physical-technological-investments",
        "section-name": "Paratransit: Capital",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-capital"
    },
    {
        "name": "7. Paratransit Financial",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "7.1 Cost-Effective Alternatives to Traditional Van Service",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial/71-cost-effective-alternatives-to-traditional-van-service",
        "section-name": "Paratransit: Financial",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial"
    },
    {
        "name": "7.2 Fare Assistance",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial/72-fare-assistance",
        "section-name": "Paratransit: Financial",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial"
    },
    {
        "name": "7.3 Clipper Payments for Paratransit Services",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial/73-clipper-payments-for-paratransit-services",
        "section-name": "Paratransit: Financial",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial"
    },
    {
        "name": "7.4 Fixed Route Fare Policy Impacts on Paratransit",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial/74-potential-changes-to-fixed-route-fare-policy",
        "section-name": "Paratransit: Financial",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-financial"
    },
    {
        "name": "8. Paratransit Eligibility and Enrollment",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "8.1 Regional Eligibility Coordination Efforts",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment/81-regional-eligibility-coordination-efforts",
        "section-name": "Paratransit: Eligibility and Enrollment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment"
    },
    {
        "name": "8.2 Improved Eligibility and Enrollment Processes",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment/82-improved-eligibility-and-enrollment-processes",
        "section-name": "Paratransit: Eligibility and Enrollment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment"
    },
    {
        "name": "8.3 Services for Prospective Paratransit Applicants",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment/83-services-for-prospective-paratransit-applicants",
        "section-name": "Paratransit: Eligibility and Enrollment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment"
    },
    {
        "name": "8.4 Online Scheduling and Payment",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment/84-online-scheduling-and-payment",
        "section-name": "Paratransit: Eligibility and Enrollment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-eligibility-and-enrollment"
    },
    {
        "name": "9. Paratransit Service Performance",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "9.1 Same Day Reservations and Chained Trips",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance/91-partnerships-with-other-agencies-and-providers",
        "section-name": "Paratransit: Service Performance",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance"
    },
    {
        "name": "9.2 Community Engagement and Partnerships",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance/92-community-engagement",
        "section-name": "Paratransit: Service Performance",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance"
    },
    {
        "name": "9.3 Staff and Contractor Recruitment",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance/93-staff-and-contractor-recruitment",
        "section-name": "Paratransit: Service Performance",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance"
    },
    {
        "name": "9.4 Regional Paratransit Connections",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance/94-regional-paratransit-connections",
        "section-name": "Paratransit: Service Performance",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/paratransit-service-performance"
    },
    {
        "name": "10. Taxis",
        "type": "section",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/taxis",
        "section-name": "Accessibility Strategy Needs Assessment",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024"
    },
    {
        "name": "10.1 Accessible Taxi Stands",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/taxis/101-accessible-taxi-stands",
        "section-name": "Taxis",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/taxis"
    },
    {
        "name": "10.2 Ramp Taxi Availability",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/taxis/102-ramp-taxis",
        "section-name": "Taxis",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/taxis"
    },
    {
        "name": "10.3 Accessibility-Informed Taxi Policies",
        "type": "page",
        "url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/taxis/103-accessibility-informed-taxi-policies",
        "section-name": "Taxis",
        "section-url": "https://www.sfmta.com/accessibility-strategy-needs-assessment-2024/taxis"
    }
]

const URL_BUCKET_MATCH = '/accessibility-strategy-needs-assessment-2024';

function isInUrlBucket() {
  return window.location.pathname.indexOf(URL_BUCKET_MATCH) !== -1;
}

function ensureAsideExists() {
  if (!isInUrlBucket()) return;

  let aside = document.querySelector('aside#sidebar, aside[role="complementary"], aside');
  if (aside) return;

  aside = document.createElement('aside');
  aside.classList.add('sidebar', 'section');
  aside.id = 'sidebar';
  aside.setAttribute('role', 'complementary');

  const rowDiv = document.body.querySelector('div.main-container > div.row');

  if (rowDiv) {
    const sectionElement = rowDiv.querySelector('section, main, .col-sm-12, .col-sm-8');
    if (sectionElement) {
      sectionElement.insertAdjacentElement('afterend', aside);
      return;
    }
    rowDiv.appendChild(aside);
    return;
  }

  document.body.appendChild(aside);
}

function main() {
  ensureAsideExists();

  const currentHref = window.location.href.replace(/\/$/, '');
  const currentPage = pages.find(p => (p.url || '').replace(/\/$/, '') === currentHref);
  const currentPageIndex = pages.findIndex(p => (p.url || '').replace(/\/$/, '') === currentHref);

  if (!currentPage || currentPageIndex < 0) return;

  const findPreviousSection = (pages, startIndex) => {
    for (let i = startIndex - 1; i >= 0; i--) {
      if (pages[i].type === 'section' || pages[i].type === 'home') {
        return pages[i];
      }
    }
    return null;
  };
  const previousSection = findPreviousSection(pages, currentPageIndex);

  const findPreviousSectionBeforeParent = (pages, startIndex) => {
    let directParentIndex = -1;
    for (let i = startIndex; i >= 0; i--) {
      if (pages[i].type === 'section' || pages[i].type === 'home') {
        directParentIndex = i;
        break;
      }
    }
    for (let i = directParentIndex - 1; i >= 0; i--) {
      if (pages[i].type === 'section' || pages[i].type === 'home') {
        return pages[i];
      }
    }
    return null;
  };
  const previousSectionBeforeParent = findPreviousSectionBeforeParent(pages, currentPageIndex);

  const findNextSection = (pages, startIndex) => {
    for (let i = startIndex + 1; i < pages.length; i++) {
      if (pages[i].type === 'section') return pages[i];
    }
    return null;
  };
  const nextSection = findNextSection(pages, currentPageIndex);

  const findPreviousPage = (pages, startIndex) => {
    for (let i = startIndex - 1; i >= 0; i--) {
      if (pages[i].type === 'section') return previousSectionBeforeParent;
      if (pages[i].type === 'page') return pages[i];
    }
    return null;
  };
  const previousPage = findPreviousPage(pages, currentPageIndex);

  const findNextPage = (pages, startIndex) => {
    for (let i = startIndex + 1; i < pages.length; i++) {
      if (pages[i].type === 'section') return nextSection;
      if (pages[i].type === 'page') return pages[i];
    }
    return null;
  };
  const nextPage = findNextPage(pages, currentPageIndex);

  const breadcrumbOrderedList = document.querySelector('.breadcrumb nav ol');

  if (breadcrumbOrderedList && currentPage.type === 'section') {
    const li = document.createElement('li');
    li.classList.add('breadcrumb-item');
    li.innerHTML = '<a href="' + currentPage['section-url'] + '">' + currentPage['section-name'] + '</a>';
    breadcrumbOrderedList.insertBefore(li, breadcrumbOrderedList.children[1]);
  }

  if (breadcrumbOrderedList && currentPage.type === 'page' && previousSection) {
    const liSection = document.createElement('li');
    liSection.classList.add('breadcrumb-item');
    liSection.innerHTML = '<a href="' + currentPage['section-url'] + '">' + currentPage['section-name'] + '</a>';
    breadcrumbOrderedList.insertBefore(liSection, breadcrumbOrderedList.children[1]);

    if (previousSection['section-name']) {
      const liHome = document.createElement('li');
      liHome.classList.add('breadcrumb-item');
      liHome.innerHTML = '<a href="' + previousSection['section-url'] + '">' + previousSection['section-name'] + '</a>';
      breadcrumbOrderedList.insertBefore(liHome, breadcrumbOrderedList.children[1]);
    }
  }

  if (currentPage.type === 'page') {
    sidebar(currentPageIndex);
  }

  if (currentPage.type === 'section' || currentPage.type === 'home') {
    ensureAsideExists();
    setTimeout(function () {
      sidebar(currentPageIndex);
    }, 25);
  }

  addSurveyButton();
}

function sidebar(currentPageIndex) {
  ensureAsideExists();

  const asideElement = document.querySelector('aside#sidebar, aside[role="complementary"], aside');
  if (!asideElement) return;

  asideElement.classList.add('col-sm-4');

  const blockElement = asideElement.querySelector('[id^="block-"]');
  if (blockElement && blockElement.parentNode === asideElement) {
    asideElement.removeChild(blockElement);
  }

  let htmlString = '';

  for (let i = 1; i < pages.length; i++) {
    let li = document.createElement('li');
    let a = document.createElement('a');

    li.style.marginTop = '.75rem';
    li.style.marginBottom = '.75rem';

    a.href = pages[i].url;
    a.innerHTML = pages[i].name;

    if (currentPageIndex === i) a.style.textDecoration = 'underline';
    if (pages[i].type === 'page') li.style.marginLeft = '1rem';

    li.innerHTML = a.outerHTML;
    htmlString += li.outerHTML;
  }

  const section = document.createElement('section');
  section.classList.add('block');
  section.style.marginRight = '15px';
  section.innerHTML =
    '<h2 class="block-title">' +
    '<span id="heading-id-12iuiu42" style="color:white;font-weight:bold;">Accessibility Strategy Needs Assessment</span><br>' +
    '<span style="font-size:16px;font-weight:bold;margin-top:24px;display:block;">Table of Contents</span>' +
    '</h2>' +
    '<div class="view-content">' +
    '<ul style="list-style:none;padding-left:1rem;">' +
    htmlString +
    '</ul></div>';

  asideElement.appendChild(section);

  const asideParent = asideElement.parentElement;
  if (asideParent) asideParent.id = 'custom-row-id-2376g3279';
}

function addSurveyButton() {
  const content = document.getElementById('block-clients-theme-system-main--2');
  if (!content) return;

  const article = content.querySelector('article');
  if (!article) return;

  const fieldShareThis = article.querySelector('.field-share-this');
  if (!fieldShareThis) return;

  const linkedInButton = fieldShareThis.querySelector('.share-linkedIn');
  if (!linkedInButton) return;

  const surveyHTML =
    '<br /><a target="_blank" class="btn-danger ml-0 mt-3" href="https://survey.alchemer.com/s3/7698449/Accessibility-Strategy-Identified-Needs-Survey-Screen-Reader-Accessible-Version">Take our survey</a>';

  linkedInButton.insertAdjacentHTML('afterend', surveyHTML);
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', main);
} else {
  main();
}
